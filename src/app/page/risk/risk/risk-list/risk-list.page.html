<ion-row>
  <ion-col size="12" class="ion-hide-lg-up">
    <ion-item *ngIf="showSearchModesforUpcomming" lines="none">
      <ion-label class="ion-text-wrap">
        <h1>Search Risks</h1>
      </ion-label>
      <ion-buttons slot="end">
        <ion-button (click)="showHideSearch()">
          <ion-icon name="contract" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
  </ion-col>
  <ion-toolbar *ngIf="viewMode!='upcoming' || showSearchModesforUpcomming">
    <ion-searchbar
      [(ngModel)]="searchText"
      (ionClear)="onClear($event)"
      (ionChange)="ionChange($event)"
    >
    </ion-searchbar>
  </ion-toolbar>
  <ion-toolbar mode="ios" *ngIf="viewMode!='upcoming' || showSearchModesforUpcomming">
    <ion-row>
      <ion-col>
        <ion-segment *ngIf="!searchText?.trim()" [value]="options.calendarOptions.pickMode" (ionChange)="calendarOptionsChanged($event)">
          <ion-segment-button value="single">
            <ion-label>Single Date</ion-label>
          </ion-segment-button>
          <ion-segment-button value="range">
            <ion-label>Date Range</ion-label>
          </ion-segment-button>
        </ion-segment>
        <ion-segment *ngIf="searchText?.trim()" [value]="searchMode" (ionChange)="SearchOptionsChanged($event)" color="primary">
          <ion-segment-button value="all">
            <ion-label>Match all keywords</ion-label>
          </ion-segment-button>
          <ion-segment-button value="any">
            <ion-label>Match any keyword</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-col>
      <ion-col>
        <ion-segment [value]="searchModeUser" (ionChange)="SearchUserOptionsChanged($event)">
          <ion-segment-button value="user">
            <ion-label>My Risks</ion-label>
          </ion-segment-button>
          <ion-segment-button value="all">
            <ion-label>All Risks</ion-label>
          </ion-segment-button>
        </ion-segment>
      </ion-col>
    </ion-row>
  </ion-toolbar>
  <ion-calendar
    *ngIf="!searchText?.trim() && (viewMode!='upcoming' || showSearchModesforUpcomming)"
    class="app-calendar"
    [options]="options.calendarOptions"
    (select)="onSelect($event)"
    (selectStart)="onSelectStart($event)"
    (selectEnd)="onSelectEnd($event)"
    (monthChange)="monthChanges($event)"
    >
  </ion-calendar>
  <ion-col>
    <ion-toolbar *ngIf="viewRiskResult?.length==0 && (viewMode!='upcoming' || showSearchModesforUpcomming)">
      <ion-item>
        <ion-label>
          <h1>Search risks</h1>
        </ion-label>
      </ion-item>
      <ion-item lines="none">
        <ion-label class="ion-text-wrap">
          <p *ngIf="dateRange.startDate || (searchText && searchText.trim().length>=2)">Sorry, we could not find any risk for the {{dateRange.startDate? 'date' : 'search keywords'}}.</p>
          <p>If you wish to create a new risk, click on the <b>add</b> risks button at the <b>bottom</b> of the screen.</p>
          <p>To search risks by date, select <b>a date</b> or <b>a date range</b>.</p>
          <p>To search risks by <b>keywords</b>, enter one or more keywords.</p>
          <p class="ion-text-center"><ion-text color="medium"><small>Here are few tips to help you with searching ... <br/>
            Try searching words appear in risk title, name or tags<br/>
            Try searching status e.g. <b>open</b>, <b>inprogress</b> or <b>resolved</b><br/>
            Try seraching one or two words<br/>
            Try <b>match any keyword</b> option for wider search result <br/></small></ion-text>
          </p>

        </ion-label>
      </ion-item>
    </ion-toolbar>
    <ion-toolbar *ngIf="viewRiskResult?.length==0 && viewMode=='upcoming' && !showSearchModesforUpcomming">
      <ion-item>
        <ion-label class="ion-text-wrap">
          <h1>No upcoming risks found</h1>
        </ion-label>
        <ion-buttons slot="end" class="ion-hide-lg-up">
          <ion-button (click)="showHideSearch()">
            <ion-icon name="search" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
      <ion-item lines="none">
        <ion-label class="ion-text-wrap">
          <p>No risks found for today. Let's create a risk.</p>
          <p class="ion-hide-lg-up">To search risks click on the serach button.
          </p>
        </ion-label>
      </ion-item>
      <ion-item lines="none">
        <ion-button class="ion-hide-md-down" slot="end" size="default"
        (featureClick)="gotoAddRisk()"
        appFeatureCheck
        [featureIdList]="['create-project-item']"
        >
          Create risk
        </ion-button>
        <ion-button class="ion-hide-md-up" slot="start" size="default"
        (featureClick)="gotoAddRisk()"
        appFeatureCheck
        [featureIdList]="['create-project-item']"
        >
          Create risk
        </ion-button>
      </ion-item>
    </ion-toolbar>
    <ion-toolbar *ngIf="viewRiskResult?.length>0 && viewMode=='upcoming' &&  !showSearchModesforUpcomming">
      <ion-item>
        <ion-label>
          <h1>Your upcoming risks</h1>
        </ion-label>
        <ion-buttons slot="end" class="ion-hide-lg-up">
          <ion-button (click)="showHideSearch()">
            <ion-icon name="search" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-toolbar>
    <ion-card class="ion-no-padding" *ngFor="let m of viewRiskResult ? viewRiskResult : [null,null,null];"  [button]="viewMode!='linkage'" (click)="openRiskDetails(m)">
      <ion-item lines="none" color="transparent">
        <ion-button slot="start" fill="solid" class="ion-no-margin margin-end-5px"
          color="{{m?.overdue=='overdue'? 'danger' : m?.data.riskStatus=='OPEN' ? 'warning' : m?.data.riskStatus=='INPROGRESS' ? 'primary' : 'green'}}">
          <ion-icon slot="start" [name]=" m?.data.riskStatus=='RESOLVED' ? 'checkbox-outline' : 'locate'"></ion-icon>
          {{(m?.data.riskStatus=='RESOLVED' ? m?.data.actualCompletionDate : m?.data.targetCompletionDate) | date : 'mediumDate'}}
          <ion-skeleton-text *ngIf="!m" animated style="width: 30%"></ion-skeleton-text>
        </ion-button>
        <ion-button slot="start" fill="solid" color="light"  class="ion-no-margin">
          <ion-icon slot="start" name="pencil"></ion-icon>
          {{m?.data.riskInitiationDate | date : 'mediumDate'}}
          <ion-skeleton-text *ngIf="!m" animated style="width: 30%"></ion-skeleton-text>
        </ion-button>
        <ion-icon slot="end" name="bookmark" size="small"
          color="{{m?.overdue=='overdue'? 'danger' : m?.data.riskStatus=='OPEN' ? 'warning' : m?.data.riskStatus=='INPROGRESS' ? 'primary' : 'green'}}">
        </ion-icon>
      </ion-item>
      <ion-card-content class="ion-no-padding ion-padding-start ion-padding-end">
        <ion-item lines="none" class="ion-no-padding"  color="transparent">
          <ion-label class="ion-no-padding ion-no-margin ion-text-wrap">
            <h1 *ngIf="m"><small>{{m.data.riskTitle}}</small></h1>
            <ion-skeleton-text *ngIf="!m" animated style="width: 80%"></ion-skeleton-text>
            <p class="app-therelines ion-text-justify">
              <ion-text  *ngIf="m" color="medium">{{m.data.riskMitigation}}</ion-text>
              <ion-skeleton-text *ngIf="!m" animated style="width: 100%"></ion-skeleton-text>
              <ion-skeleton-text *ngIf="!m" animated style="width: 100%"></ion-skeleton-text>
            </p>
          </ion-label>
        </ion-item>
        <ion-row class="ion-no-padding ion-no-margin">
          <ion-col size="8" [sizeLg]="showSearchModesforUpcomming ? '8' : '9'" size-xl="9">
            <ion-item class="ion-no-padding" lines="none" color="transparent">
              <ion-icon *ngIf="!m?.data.riskInitiator?.picUrl" color="green" name="person-circle" slot="start" size="large">
              </ion-icon>
              <img *ngIf="m?.data.riskInitiator?.picUrl" slot="start"
                src="{{(m?.data.riskInitiator?.picUrl) ? m?.data.riskInitiator?.picUrl : ''}}"
                (error)="profileImgErrorHandler(m?.data.riskInitiator)" style="height:30px; width:30px;border-radius:50%;object-fit: cover; overflow: hidden;" />
              <ion-label>
                <h2 *ngIf="m">Initiator</h2>
                <p *ngIf="m">
                  <ion-text color="medium">{{m.data.riskInitiator.name}}</ion-text>
                </p>
                <ion-skeleton-text *ngIf="!m" animated style="width: 40%"></ion-skeleton-text>
                <ion-skeleton-text *ngIf="!m" animated style="width: 60%"></ion-skeleton-text>
              </ion-label>
            </ion-item>
            <ion-item class="ion-no-padding" lines="none" color="transparent">
              <ion-icon *ngIf="!m?.data.riskOwner?.picUrl" color="green" name="person-circle" slot="start" size="large">
              </ion-icon>
              <img *ngIf="m?.data.riskOwner?.picUrl" slot="start"
                src="{{(m?.data.riskOwner?.picUrl) ? m?.data.riskOwner?.picUrl : ''}}"
                (error)="profileImgErrorHandler(m?.data.riskOwner)" style="height:30px; width:30px;border-radius:50%;object-fit: cover; overflow: hidden;" />
              <ion-label>
                <h2 *ngIf="m">Owner</h2>
                <p *ngIf="m">
                  <ion-text color="medium">{{m.data.riskOwner.name}}</ion-text>
                </p>
                <ion-skeleton-text *ngIf="!m" animated style="width: 40%"></ion-skeleton-text>
                <ion-skeleton-text *ngIf="!m" animated style="width: 60%"></ion-skeleton-text>
              </ion-label>
            </ion-item>
          </ion-col>
          <ion-col  size="4" [sizeLg]="showSearchModesforUpcomming ? '4' : '3'" size-xl="3" class="ion-no-padding">
            <app-risk-matrix *ngIf="m" [highLightCells]="m.highLightCells"></app-risk-matrix>
          </ion-col>
        </ion-row>
        <!-- <ion-row>
          <ion-col> -->
            <!-- <ion-item class="ion-no-padding" lines="none"  color="transparent">
              <ion-icon *ngIf="!m?.data.riskOwner?.picUrl" color="green" name="person-circle" slot="start" size="large"></ion-icon>
              <img *ngIf="m?.data.riskOwner?.picUrl" slot="start"
                src="{{(m?.data.riskOwner?.picUrl) ? m?.data.riskOwner?.picUrl : ''}}"
                (error)="profileImgErrorHandler(m?.data.riskOwner)"
                style="height:30px; width:30px;border-radius:50%;"
                />
              <ion-label>
                <h2  *ngIf="m">Owner</h2>
                <p *ngIf="m"><ion-text color="medium">{{m.data.riskOwner.name}}</ion-text></p>
                <ion-skeleton-text *ngIf="!m" animated style="width: 40%"></ion-skeleton-text>
                <ion-skeleton-text *ngIf="!m" animated style="width: 60%"></ion-skeleton-text>
              </ion-label>
            </ion-item> -->
          <!-- </ion-col>
          <ion-col>
            <ion-item class="ion-no-padding" lines="none"  color="transparent">
              <ion-icon *ngIf="!m?.data.riskInitiator?.picUrl" color="green" name="person-circle" slot="start" size="large"></ion-icon>
              <img *ngIf="m?.data.riskInitiator?.picUrl" slot="start"
                src="{{(m?.data.riskInitiator?.picUrl) ? m?.data.riskInitiator?.picUrl : ''}}"
                (error)="profileImgErrorHandler(m?.data.riskInitiator)"
                style="height:30px; width:30px;border-radius:50%;"
                />
              <ion-label>
                <h2  *ngIf="m">Initiator</h2>
                <p *ngIf="m"><ion-text color="medium">{{m.data.riskInitiator.name}}</ion-text></p>
                <ion-skeleton-text *ngIf="!m" animated style="width: 40%"></ion-skeleton-text>
                <ion-skeleton-text *ngIf="!m" animated style="width: 60%"></ion-skeleton-text>
              </ion-label>
            </ion-item>
          </ion-col>
        </ion-row> -->
        <ion-item class="ion-no-padding" lines="none" color="transparent">
         <img *ngIf="m?.data.latestComment.totalComments > 0"
          src="{{(m?.data.latestComment.picUrl) ? m?.data.latestComment.picUrl : ''}}"
          (error)="profileImgErrorHandler(m?.data.latestComment)" style="height:30px; width:30px;border-radius:50%;object-fit: cover; overflow: hidden;" />
          <ion-icon slot="start" name="chatbubbles" class="ion-no-margin" *ngIf="m?.data.latestComment.totalComments == 0"></ion-icon>
          <ion-label class="ion-no-padding ion-margin ion-text-wrap">
            <p class="app-twolines">{{m?.data.latestComment.totalComments == 0 ? 'Be the first person to post comment for the risk' : m?.data.latestComment.comment}}</p>
            <ion-skeleton-text *ngIf="!m" animated style="width: 40%"></ion-skeleton-text>
            <ion-skeleton-text *ngIf="!m" animated style="width: 60%"></ion-skeleton-text>
          </ion-label>
        </ion-item>
        <ion-item *ngIf="viewMode=='linkage'" class="ion-no-padding" lines="none" color="transparent">
          <ion-buttons *ngIf="viewMode=='linkage'" slot="end">
            <ion-button slot="end"
            (featureClick)="onLinkRisk(m)"
            appFeatureCheck
            [featureIdList]="['link-project-item']"
            >
              <ion-icon name="attach" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-card-content>
    </ion-card>
    <ion-toolbar *ngIf="viewRiskResult?.length>=15 && (viewMode!='upcoming' || showSearchModesforUpcomming)">
      <ion-item>
        <ion-label>
          <h1>Refine your search</h1>
        </ion-label>
      </ion-item>
      <ion-item lines="none">
        <ion-label class="ion-text-wrap">
          <p *ngIf="dateRange.startDate || (searchText && searchText.trim().length>=2)">
            Have you found the risk you are looking for? <br/>
            It seems that the serach is matching too many rows.
          </p>
          <p>Try refining the serach conditions.</p>
          <p>To search risks by date, select <b>a date</b> or <b>a shorter date range</b>.</p>
          <p>To search risks by <b>keywords</b>, enter <b>two or more</b> keywords.</p>
          <p>
            Avoid searching only by status e.g. <b>open</b>, <b>cancel</b> or <b>completed</b> as these will lead to wider match<br/>
            Try <b>match all keyword</b> option to limit search result <br/>
          </p>

        </ion-label>
      </ion-item>
    </ion-toolbar>
  </ion-col>
</ion-row>
